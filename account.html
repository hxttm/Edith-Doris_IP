<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Dream — Account</title>
    <link rel="stylesheet" href="phone.css" />
  </head>

  <body>
    <div class="dreampage dreamaccount has-nav" id="pageRoot">
      <main class="dreamaccount_screen" aria-label="Account">
        <header class="ui_top">
          <a class="ui_back" href="./settings.html" aria-label="Back">‹</a>
          <div class="ui_title">Account</div>
          <div class="ui_top_spacer" aria-hidden="true"></div>
        </header>

        <button class="dreamaccount_row" type="button" data-open="edu">
          <span>Education level</span>
          <span class="dreamaccount_chev" aria-hidden="true">›</span>
        </button>

        <button class="dreamaccount_row" type="button" data-open="password">
          <span>Change password</span>
          <span class="dreamaccount_chev" aria-hidden="true">›</span>
        </button>

        <button class="dreamaccount_row " type="button" >
          <span>Delete account</span>
          <span class="dreamaccount_chev" aria-hidden="true">›</span>
        </button>

        </section>

        <nav class="ui_nav" aria-label="Bottom navigation">
          <a class="ui_nav_item" href="./buddy.html" aria-label="Customising avatar">
            <img class="ui_nav_icon" src="./assets/nav/avatar.png" alt="" />
          </a>

          <a class="ui_nav_item" href="./market.html" aria-label="Notes market">
            <img class="ui_nav_icon" src="./assets/nav/market.png" alt="" />
          </a>

          <a class="ui_nav_item" href="./index.html" aria-label="Home">
            <img class="ui_nav_icon" src="./assets/nav/home.png" alt="" />
          </a>

          <a class="ui_nav_item" href="./chat.html" aria-label="Chat">
            <img class="ui_nav_icon" src="./assets/nav/chat.png" alt="" />
          </a>

          <a class="ui_nav_item ui_nav_item_active" href="./settings.html" aria-label="Settings">
            <img class="ui_nav_icon" src="./assets/nav/settings.png" alt="" />
          </a>
        </nav>
      </main>
    </div>

    <script>
      const buddy = localStorage.getItem("dream_buddy") || "blue";
      const root = document.getElementById("pageRoot");
      root?.classList.toggle("orange", buddy === "orange");
      root?.classList.toggle("blue", buddy !== "orange");

      const overlayHTML = `
        <div class="ui_overlay" id="overlayEdu" hidden>
          <div class="ui_overlay_backdrop" data-close="overlayEdu" aria-hidden="true"></div>
          <section class="ui_overlay_card" role="dialog" aria-modal="true" aria-labelledby="overlayEduTitle" tabindex="-1">
            <header class="ui_overlay_head">
              <h2 class="ui_overlay_title" id="overlayEduTitle">Education level</h2>
              <button class="ui_overlay_close" type="button" data-close="overlayEdu" aria-label="Close">×</button>
            </header>

            <div class="ui_overlay_body">
              <button type="button" class="ui_choice">Secondary</button>
              <button type="button" class="ui_choice">Polytechnic</button>
              <button type="button" class="ui_choice">JC</button>
              <button type="button" class="ui_choice">University</button>
            </div>
          </section>
        </div>

        <div class="ui_overlay" id="overlayPassword" hidden>
          <div class="ui_overlay_backdrop" data-close="overlayPassword" aria-hidden="true"></div>
          <section class="ui_overlay_card" role="dialog" aria-modal="true" aria-labelledby="overlayPasswordTitle" tabindex="-1">
            <header class="ui_overlay_head">
              <h2 class="ui_overlay_title" id="overlayPasswordTitle">Change password</h2>
              <button class="ui_overlay_close" type="button" data-close="overlayPassword" aria-label="Close">×</button>
            </header>

            <form class="ui_overlay_body" autocomplete="off">
              <label class="ui_field">
                <span>Current password</span>
                <input type="password" name="current" required />
              </label>
              <label class="ui_field">
                <span>New password</span>
                <input type="password" name="next" required />
              </label>
              <button type="submit" class="ui_primary">Update</button>
            </form>
          </section>
        </div>
      `;

      document.body.insertAdjacentHTML("beforeend", overlayHTML);

      const pageMain = document.querySelector("main");
      let lastTrigger = null;

      function openOverlay(id, triggerEl) {
        const overlay = document.getElementById(id);
        if (!overlay) return;

        lastTrigger = triggerEl || document.activeElement;
        overlay.hidden = false;
        pageMain?.setAttribute("aria-hidden", "true");
        document.body.style.overflow = "hidden";

        const card = overlay.querySelector(".ui_overlay_card");
        card?.focus();
      }

      function closeOverlay(id) {
        const overlay = document.getElementById(id);
        if (!overlay) return;

        overlay.hidden = true;
        pageMain?.removeAttribute("aria-hidden");
        document.body.style.overflow = "";

        if (lastTrigger && typeof lastTrigger.focus === "function") lastTrigger.focus();
        lastTrigger = null;
      }

      document.querySelectorAll("[data-open]").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          const key = btn.getAttribute("data-open");
          if (key === "edu") openOverlay("overlayEdu", btn);
          if (key === "password") openOverlay("overlayPassword", btn);
        });
      });

      document.body.addEventListener("click", (e) => {
        const t = e.target;
        if (!(t instanceof HTMLElement)) return;
        const id = t.getAttribute("data-close");
        if (id) closeOverlay(id);
      });

      document.addEventListener("keydown", (e) => {
        if (e.key !== "Escape") return;
        const openOne = document.querySelector(".ui_overlay:not([hidden])");
        if (openOne?.id) closeOverlay(openOne.id);
      });

      document.body.addEventListener("submit", (e) => {
        const form = e.target;
        if (!(form instanceof HTMLFormElement)) return;
        if (form.closest("#overlayPassword")) {
          e.preventDefault();
          closeOverlay("overlayPassword");
        }
      });
    </script>

      </body>
    </html>
