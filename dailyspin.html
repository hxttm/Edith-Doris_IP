<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dream — Daily Spin</title>
  <link rel="stylesheet" href="phone.css" />
</head>
<body>
  <div class="dreampage dreampage_has_nav" id="pageRoot">
    <main class="ui_screen" aria-label="Daily Spin">
      <header class="ui_top">
        <a class="ui_back" href="./index.html" aria-label="Back">‹</a>
        <div class="ui_title">Daily Spin</div>
        <div class="ui_top_spacer" aria-hidden="true"></div>
      </header>

      <section class="spin_area" aria-label="Spin wheel area">
        <div class="pointer" aria-hidden="true"></div>

        <div class="wheelWrap">
          <div class="wheelStack">
            <button class="wheel" id="wheel" type="button" aria-label="Spin">
              <span class="center" aria-hidden="true">SPIN!</span>
            </button>

            <div class="base" aria-hidden="true">
              <div class="baseText" id="spinLeft">1 Spin Left</div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <nav class="ui_nav" aria-label="Bottom navigation">
      <a class="ui_nav_item" href="./buddy.html" aria-label="Customising avatar">
        <img class="ui_nav_icon" src="./assets/nav/avatar.png" alt="" />
      </a>

      <a class="ui_nav_item ui_nav_item_active" href="./market.html" aria-label="Notes market" aria-current="page">
        <img class="ui_nav_icon" src="./assets/nav/market.png" alt="" />
      </a>

      <a class="ui_nav_item" href="./index.html" aria-label="Home">
        <img class="ui_nav_icon" src="./assets/nav/home.png" alt="" />
      </a>

      <a class="ui_nav_item" href="./chat.html" aria-label="Chat">
        <img class="ui_nav_icon" src="./assets/nav/chat.png" alt="" />
      </a>

      <a class="ui_nav_item" href="./settings.html" aria-label="Settings">
        <img class="ui_nav_icon" src="./assets/nav/settings.png" alt="" />
      </a>
    </nav>
  </div>

  <script>
    const buddy = localStorage.getItem("dream_buddy") || "blue";
    const root = document.getElementById("pageRoot");
    root.classList.toggle("orange", buddy === "orange");
    root.classList.toggle("blue", buddy !== "orange"); 
    
    document.querySelector(".ui_back")?.addEventListener("click", (e) => {
      if (history.length > 1) {
        e.preventDefault();
        history.back();
      }
    });

    const wheel = document.getElementById("wheel");
    const spinLeftEl = document.getElementById("spinLeft");

    let spinsLeft = 1;
    let currentRotation = 0;

    function updateSpinLeft(){
      spinLeftEl.textContent = spinsLeft > 0 ? `${spinsLeft} Spin Left` : "0 Spin Left";
    }
    updateSpinLeft();

    wheel.addEventListener("click", () => {
      if (spinsLeft <= 0) return;

      spinsLeft -= 1;
      updateSpinLeft();

      const slices = 6;
      const step = 360 / slices;
      const chosen = Math.floor(Math.random() * slices);
      const extraTurns = 6 * 360;

      const target = extraTurns + (360 - (chosen * step + step / 2));
      currentRotation += target;

      wheel.style.transform = `rotate(${currentRotation}deg)`;
    });
  </script>
</body>
</html>
