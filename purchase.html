<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Enzyme Kinetics â€” Notes Market</title>
  <link rel="stylesheet" href="./phone.css" />
</head>

<body>
  <div class="dreampage dreampage_has_nav" id="pageRoot">
    <main class="ui_screen" aria-label="Purchase Note">
      <header class="ui_top">
        <a class="ui_back" href="./market.html" aria-label="Back">â€¹</a>
        <div class="ui_title">Enzyme Kinetics</div>
        <div class="ui_top_spacer" aria-hidden="true"></div>
      </header>

      <section class="ui_section">
        <img src="./assets/note/EK.png" class="note_preview_img" alt="" />

        <div class="notes_title">Enzyme Kinetics</div>

        <div class="note_price_rating">
          <div class="note_price" id="notePrice">3ðŸ’Ž</div>
          <div class="note_stars">â˜…â˜…â˜…â˜…â˜†</div> 
        </div>

        <div class="note_seller">
          <img class="seller_avatar" src="./assets/pfp/kj.jpg" alt="@KwayJo" />
          <div>
            <div class="seller_name">@KwayJo</div>
            <div class="seller_rating">4.5â˜…</div>
          </div>
        </div>

        <div class="note_description">
          Clear summary with Km graphs, Vmax explanations and diagrams.
        </div>

        <button class="buy_button" id="buyBtn" type="button">
          Buy notes for <span id="buyPrice">3ðŸ’Ž</span>
        </button>

        <div class="note_sales">13 sold</div>
      </section>
    </main>

    <nav class="ui_nav" aria-label="Bottom navigation">
      <a class="ui_nav_item" href="./buddy.html">
        <img class="ui_nav_icon" src="./assets/nav/avatar.png" alt="" />
      </a>
      <a class="ui_nav_item ui_nav_item_active" href="./market.html" aria-current="page">
        <img class="ui_nav_icon" src="./assets/nav/market.png" alt="" />
      </a>
      <a class="ui_nav_item" href="./index.html">
        <img class="ui_nav_icon" src="./assets/nav/home.png" alt="" />
      </a>
      <a class="ui_nav_item" href="./chat.html">
        <img class="ui_nav_icon" src="./assets/nav/chat.png" alt="" />
      </a>
      <a class="ui_nav_item" href="./settings.html">
        <img class="ui_nav_icon" src="./assets/nav/settings.png" alt="" />
      </a>
    </nav>
  </div>

  <script>
    const NOTE_ID = "enzyme-kinetics";
    const NOTE_TITLE = "Enzyme Kinetics";
    const NOTE_PRICE = 3;
    const buyBtn = document.getElementById("buyBtn");

    function getGems() { 
      return Number(sessionStorage.getItem("gems") || "10"); 
    }
    function setGems(n) { 
      sessionStorage.setItem("gems", String(n)); 
    }
    function getOwned() { 
      return JSON.parse(sessionStorage.getItem("owned_notes") || "[]"); 
    }
    function setOwned(arr) { 
      sessionStorage.setItem("owned_notes", JSON.stringify(arr)); 
    }

    function updateBuyButton() {
      const owned = getOwned();
      const gems = getGems();

      if (owned.includes(NOTE_ID)) {
        buyBtn.innerHTML = "âœ“ Owned<br><small>Open in Your Notes</small>";
        buyBtn.onclick = () => window.location.href = "./notes.html";
        buyBtn.style.background = "#4CAF50";
        buyBtn.style.color = "white";
        return;
      }

      if (gems < NOTE_PRICE) {
        buyBtn.innerHTML = `ðŸ’Ž${gems}<br><small>Get more ðŸ’Ž</small>`;
        buyBtn.onclick = () => window.location.href = "./dailyspin.html";
        buyBtn.style.background = "#FF9800";
        return;
      }

      buyBtn.innerHTML = `Buy for ${NOTE_PRICE}ðŸ’Ž`;
      buyBtn.onclick = buyNote;
      buyBtn.style.background = "#6FADC4";
    }

    function buyNote() {
      const gems = getGems();
      if (gems < NOTE_PRICE) {
        alert(`Not enough ðŸ’Ž! You have ${gems}, need ${NOTE_PRICE}.`);
        return;
      }

      const confirmed = confirm(
        `Buy "${NOTE_TITLE}" for ${NOTE_PRICE}ðŸ’Ž?\n\n` +
        `ðŸ’Ž Balance: ${gems} â†’ ${gems - NOTE_PRICE}`
      );

      if (!confirmed) return;

      setGems(gems - NOTE_PRICE);
      const owned = getOwned();
      owned.push(NOTE_ID);
      setOwned(owned);

      alert("ðŸŽ‰ Purchased successfully!\nAdded to Your Notes.");
      updateBuyButton();
    }

    // Theme
    const buddy = localStorage.getItem("dream_buddy") || "blue";
    const root = document.getElementById("pageRoot");
    root?.classList.toggle("orange", buddy === "orange");
    root?.classList.toggle("blue", buddy !== "orange");

    // Back button (single listener)
    document.querySelector(".ui_back")?.addEventListener("click", (e) => {
      if (history.length > 1) {
        e.preventDefault();
        history.back();
      }
    });

    // Initialize
    updateBuyButton();
  </script>
</body>
</html>
